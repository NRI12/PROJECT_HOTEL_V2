{% extends "admin/base.html" %}
{% from "components/pagination.html" import render_pagination %}

{% block title %}Quản lý Đánh giá{% endblock %}

{% block content %}

<div class="owner-header">
    <div>
        <h1 class="owner-header-title">
            <i class="fas fa-star me-2"></i> Quản lý Đánh giá
        </h1>
        <p class="owner-header-subtitle">Danh sách tất cả đánh giá trong hệ thống</p>
    </div>
</div>

{% set payload = result[0].json if result and result[1] == 200 else None %}
{% set reviews = payload.data.reviews if payload and payload.data and payload.data.reviews else [] %}
{% set pagination = payload.data.pagination if payload and payload.data and payload.data.pagination else None %}

<div class="owner-table-wrapper">
    <div class="owner-table-header">
        <h5><i class="fas fa-list me-2"></i> Danh sách đánh giá</h5>
        <span class="badge bg-primary" style="font-size: 1rem; padding: 0.5rem 1rem;">
            {% if pagination %}{{ pagination.total }}{% else %}{{ reviews|length }}{% endif %} đánh giá
        </span>
    </div>
    {% if reviews %}
        <div class="p-3">
            {% for review in reviews %}
                <div class="owner-review-card mb-3">
                    <div class="owner-review-header">
                        <div>
                            <div class="owner-review-user">
                                <i class="fas fa-user-circle me-2"></i>
                                {{ review.user.full_name if review.user and review.user.full_name else (review.user.email if review.user else 'N/A') }}
                            </div>
                            <div class="text-muted small">
                                <i class="fas fa-hotel me-1"></i>
                                {{ review.hotel.hotel_name if review.hotel else 'N/A' }}
                            </div>
                        </div>
                        <div class="text-end">
                            <div class="owner-review-rating mb-2">
                                {% if review.rating %}
                                    {% for i in range(5) %}
                                        {% if i < review.rating %}
                                            <i class="fas fa-star"></i>
                                        {% else %}
                                            <i class="far fa-star"></i>
                                        {% endif %}
                                    {% endfor %}
                                    <strong class="ms-2">{{ review.rating }}/5</strong>
                                {% else %}
                                    <span class="text-muted">Chưa có đánh giá</span>
                                {% endif %}
                            </div>
                            {% if review.status %}
                            <span class="owner-badge status-{{ review.status }}">
                                {{ review.status }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="owner-review-content">
                        {% if review.comment %}
                            {{ review.comment }}
                        {% else %}
                            <em class="text-muted">Không có nhận xét</em>
                        {% endif %}
                    </div>
                    <div class="owner-review-footer">
                        <div>
                            <i class="fas fa-hashtag me-1"></i>
                            <strong>#{{ review.review_id }}</strong>
                        </div>
                        <div>
                            <form method="POST" action="{{ url_for('admin.admin_review_hide', review_id=review.review_id) }}" style="display: inline;">
                                <button type="submit" class="btn btn-sm btn-warning">
                                    <i class="fas fa-eye-slash"></i> Ẩn
                                </button>
                            </form>
                            <form method="POST" action="{{ url_for('admin.admin_review_delete', review_id=review.review_id) }}" 
                                  style="display: inline;" 
                                  onsubmit="return confirm('Xóa đánh giá này?');">
                                <button type="submit" class="btn btn-sm btn-danger">
                                    <i class="fas fa-trash"></i> Xóa
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        {% if pagination %}
        {{ render_pagination(pagination, 'admin.admin_reviews') }}
        {% endif %}
    {% else %}
        <div class="owner-empty-state">
            <div class="owner-empty-icon"><i class="fas fa-star-half-alt"></i></div>
            <h4 class="owner-empty-title">Chưa có đánh giá</h4>
        </div>
    {% endif %}
</div>

{% endblock %}
