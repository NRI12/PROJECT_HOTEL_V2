{% extends "owner/base.html" %}

{% block title %}Thêm phòng mới{% endblock %}

{% block content %}

<div class="owner-header">
    <div>
        <h1 class="owner-header-title">Thêm phòng mới</h1>
        <p class="owner-header-subtitle">Tạo phòng mới với đầy đủ thông tin</p>
    </div>
</div>

{% if error %}
<div class="alert alert-danger">{{ error }}</div>
{% endif %}

<div class="owner-card">
    <form method="POST" enctype="multipart/form-data">
        
        <!-- BƯỚC 1: THÔNG TIN CƠ BẢN -->
        <h5 class="mb-3 pb-2 border-bottom">1. Thông tin cơ bản</h5>
        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <label class="form-label">Khách sạn *</label>
                <select name="hotel_id" class="form-control" required>
                    <option value="">-- Chọn khách sạn --</option>
                    {% for hotel in hotels %}
                    <option value="{{ hotel.hotel_id }}">{{ hotel.hotel_name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-6">
                <label class="form-label">Loại phòng *</label>
                <select name="room_type_id" class="form-control" required>
                    <option value="">-- Chọn loại phòng --</option>
                    {% for room_type in room_types %}
                    <option value="{{ room_type.type_id }}">{{ room_type.type_name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-6">
                <label class="form-label">Tên phòng *</label>
                <input type="text" name="room_name" class="form-control" placeholder="VD: Phòng Deluxe 101" required>
            </div>

            <div class="col-md-6">
                <label class="form-label">Số phòng</label>
                <input type="text" name="room_number" class="form-control" placeholder="VD: 101, A-203">
            </div>

            <div class="col-12">
                <label class="form-label">Mô tả</label>
                <textarea name="description" class="form-control" rows="3" placeholder="Mô tả về phòng..."></textarea>
            </div>
        </div>

        <!-- BƯỚC 2: CHI TIẾT PHÒNG -->
        <h5 class="mb-3 pb-2 border-bottom">2. Chi tiết phòng</h5>
        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <label class="form-label">Diện tích (m²)</label>
                <input type="number" name="area" class="form-control" placeholder="25" step="0.01">
            </div>

            <div class="col-md-4">
                <label class="form-label">Số khách tối đa *</label>
                <input type="number" name="max_guests" class="form-control" placeholder="2" min="1" required>
            </div>

            <div class="col-md-4">
                <label class="form-label">Số giường</label>
                <input type="number" name="num_beds" class="form-control" placeholder="1" min="1" value="1">
            </div>

            <div class="col-md-12">
                <label class="form-label">Loại giường</label>
                <select name="bed_type" class="form-control">
                    <option value="">-- Chọn loại giường --</option>
                    <option value="Single">Single (Đơn)</option>
                    <option value="Twin">Twin (2 đơn)</option>
                    <option value="Double">Double (Đôi)</option>
                    <option value="Queen">Queen</option>
                    <option value="King">King</option>
                </select>
            </div>
        </div>

        <!-- BƯỚC 3: GIÁ PHÒNG -->
        <h5 class="mb-3 pb-2 border-bottom">3. Giá phòng</h5>
        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <label class="form-label">Giá cơ bản/đêm (VNĐ) *</label>
                <input type="number" name="base_price" class="form-control" placeholder="500000" step="0.01" required>
                <small class="text-muted">Giá cho các ngày thường (Thứ 2 - Thứ 5)</small>
            </div>

            <div class="col-md-6">
                <label class="form-label">Giá cuối tuần (VNĐ)</label>
                <input type="number" name="weekend_price" class="form-control" placeholder="700000" step="0.01">
                <small class="text-muted">Giá cho Thứ 6, Thứ 7, Chủ nhật</small>
            </div>
        </div>

        <!-- BƯỚC 4: HÌNH ẢNH -->
        <h5 class="mb-3 pb-2 border-bottom">4. Hình ảnh phòng *</h5>
        <div class="mb-4">
            <label class="form-label">Upload hình ảnh</label>
            <input type="file" name="images" class="form-control" multiple accept="image/*" id="imageInput">
            <small class="text-muted">Chọn nhiều ảnh (JPG, PNG, GIF, WEBP). Ảnh đầu tiên sẽ là ảnh chính.</small>
            
            <div id="imagePreview" class="mt-3" style="display: none;">
                <div class="row g-2" id="previewContainer"></div>
            </div>
        </div>

        <!-- BƯỚC 5: TIỆN NGHI -->
        <h5 class="mb-3 pb-2 border-bottom">5. Tiện nghi phòng</h5>
        <div class="mb-4">
            {% if amenities %}
            <div class="row">
                {% for amenity in amenities %}
                <div class="col-md-4 mb-2">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="amenity_ids" value="{{ amenity.amenity_id }}" id="amenity{{ amenity.amenity_id }}">
                        <label class="form-check-label" for="amenity{{ amenity.amenity_id }}">
                            {% if amenity.icon %}{{ amenity.icon }}{% endif %} {{ amenity.amenity_name }}
                        </label>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-muted">Chưa có tiện nghi nào. Bạn có thể thêm sau.</p>
            {% endif %}
        </div>

        <!-- NÚT HÀNH ĐỘNG -->
        <div class="col-12">
            <button type="submit" class="owner-btn owner-btn-primary">
                <i class="fas fa-save"></i> Tạo phòng
            </button>
            <a href="{{ url_for('owner.owner_rooms') }}" class="owner-btn owner-btn-outline-secondary">
                <i class="fas fa-times"></i> Hủy
            </a>
        </div>
    </form>
</div>

<script>
document.getElementById('imageInput').addEventListener('change', function(e) {
    const previewDiv = document.getElementById('imagePreview');
    const container = document.getElementById('previewContainer');
    const files = e.target.files;
    
    if (files.length > 0) {
        container.innerHTML = '';
        previewDiv.style.display = 'block';
        
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const col = document.createElement('div');
                col.className = 'col-md-3';
                col.innerHTML = `
                    <div class="position-relative">
                        <img src="${e.target.result}" class="img-thumbnail" style="width: 100%; height: 150px; object-fit: cover;">
                        ${i === 0 ? '<span class="badge bg-primary position-absolute top-0 start-0 m-2">Ảnh chính</span>' : ''}
                    </div>
                `;
                container.appendChild(col);
            };
            
            reader.readAsDataURL(file);
        }
    } else {
        previewDiv.style.display = 'none';
    }
});
</script>

{% endblock %}