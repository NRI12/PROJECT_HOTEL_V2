{% extends "owner/base.html" %}

{% block title %}Chỉnh sửa khách sạn{% endblock %}

{% block content %}

<div class="owner-header">
    <div>
        <h1 class="owner-header-title">
            <i class="fas fa-hotel me-2"></i> Chỉnh sửa khách sạn
        </h1>
        <p class="owner-header-subtitle">Cập nhật thông tin khách sạn của bạn</p>
    </div>
    <div class="owner-header-actions">
        <a href="{{ url_for('hotel.hotel_detail', hotel_id=hotel_id) }}" class="owner-btn owner-btn-outline">
            <i class="fas fa-arrow-left"></i> Quay lại
        </a>
    </div>
</div>

{% if result and result[0].get_json() and result[0].get_json().success %}
    {% set hotel = result[0].get_json().data.hotel %}

    <div class="owner-card">
        <form method="POST" action="{{ url_for('hotel.edit_hotel', hotel_id=hotel_id) }}" enctype="multipart/form-data">
            <div class="row g-3">
                <!-- Thông tin cơ bản -->
                <div class="col-12">
                    <h5 class="mb-3">
                        <i class="fas fa-info-circle me-2 text-primary"></i>
                        Thông tin cơ bản
                    </h5>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Tên khách sạn *</label>
                    <input type="text" name="hotel_name" class="form-control" 
                           value="{{ request.form.hotel_name or hotel.hotel_name or '' }}" 
                           placeholder="VD: Khách sạn ABC" required>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Số sao (1-5) *</label>
                    <select name="star_rating" class="form-control" required>
                        <option value="">-- Chọn số sao --</option>
                        {% for star in range(1, 6) %}
                        <option value="{{ star }}" {{ 'selected' if (request.form.star_rating or hotel.star_rating)|int == star }}>
                            {{ star }} <i class="fas fa-star"></i>
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-12">
                    <label class="form-label">Mô tả</label>
                    <textarea name="description" class="form-control" rows="4" 
                              placeholder="Mô tả chi tiết về khách sạn...">{{ request.form.description or hotel.description or '' }}</textarea>
                </div>

                <!-- Địa chỉ -->
                <div class="col-12 mt-4">
                    <h5 class="mb-3">
                        <i class="fas fa-map-marker-alt me-2 text-danger"></i>
                        Địa chỉ
                    </h5>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Địa chỉ *</label>
                    <input type="text" name="address" class="form-control" 
                           value="{{ request.form.address or hotel.address or '' }}" 
                           placeholder="Số nhà, đường..." required>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Phường/Xã</label>
                    <input type="text" name="ward" class="form-control" 
                           value="{{ request.form.ward or hotel.ward or '' }}" 
                           placeholder="VD: Phường 1">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Quận/Huyện</label>
                    <input type="text" name="district" class="form-control" 
                           value="{{ request.form.district or hotel.district or '' }}" 
                           placeholder="VD: Quận 1">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Thành phố *</label>
                    <input type="text" name="city" class="form-control" 
                           value="{{ request.form.city or hotel.city or '' }}" 
                           placeholder="VD: Hồ Chí Minh" required>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Vĩ độ (Latitude)</label>
                    <input type="number" name="latitude" class="form-control" step="0.00000001"
                           value="{{ request.form.latitude or hotel.latitude or '' }}" 
                           placeholder="VD: 10.762622">
                    <small class="text-muted">Dùng để hiển thị bản đồ</small>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Kinh độ (Longitude)</label>
                    <input type="number" name="longitude" class="form-control" step="0.00000001"
                           value="{{ request.form.longitude or hotel.longitude or '' }}" 
                           placeholder="VD: 106.660172">
                    <small class="text-muted">Dùng để hiển thị bản đồ</small>
                </div>

                <!-- Liên hệ -->
                <div class="col-12 mt-4">
                    <h5 class="mb-3">
                        <i class="fas fa-phone me-2 text-success"></i>
                        Thông tin liên hệ
                    </h5>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Số điện thoại</label>
                    <input type="text" name="phone" class="form-control" 
                           value="{{ request.form.phone or hotel.phone or '' }}" 
                           placeholder="VD: 0912345678">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Email</label>
                    <input type="email" name="email" class="form-control" 
                           value="{{ request.form.email or hotel.email or '' }}" 
                           placeholder="VD: hotel@example.com">
                </div>

                <!-- Chính sách -->
                <div class="col-12 mt-4">
                    <h5 class="mb-3">
                        <i class="fas fa-clock me-2 text-warning"></i>
                        Chính sách nhận/trả phòng
                    </h5>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Giờ nhận phòng (Check-in)</label>
                    <input type="time" name="check_in_time" class="form-control" 
                           value="{{ request.form.check_in_time or (hotel.check_in_time[:5] if hotel.check_in_time else '14:00') }}">
                    <small class="text-muted">Mặc định: 14:00</small>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Giờ trả phòng (Check-out)</label>
                    <input type="time" name="check_out_time" class="form-control"
                           value="{{ request.form.check_out_time or (hotel.check_out_time[:5] if hotel.check_out_time else '12:00') }}">
                    <small class="text-muted">Mặc định: 12:00</small>
                </div>

                <!-- Upload ảnh (optional) -->
                <div class="col-12 mt-4">
                    <h5 class="mb-3">
                        <i class="fas fa-images me-2 text-info"></i>
                        Thêm hình ảnh mới (tùy chọn)
                    </h5>
                </div>

                <div class="col-12">
                    <label class="form-label">Chọn ảnh để thêm</label>
                    <input type="file" name="images" class="form-control" multiple accept="image/*">
                    <small class="text-muted">Chọn nhiều ảnh (JPG, PNG, GIF, WEBP) để thêm vào khách sạn. Để trống nếu không muốn thêm ảnh.</small>
                </div>

                <!-- Buttons -->
                <div class="col-12 mt-4">
                    <button type="submit" class="owner-btn owner-btn-primary">
                        <i class="fas fa-save"></i> Cập nhật khách sạn
                    </button>
                    <a href="{{ url_for('hotel.hotel_detail', hotel_id=hotel_id) }}" class="owner-btn owner-btn-outline-secondary">
                        <i class="fas fa-times"></i> Hủy
                    </a>
                    <a href="{{ url_for('owner.my_hotels') }}" class="owner-btn owner-btn-outline">
                        <i class="fas fa-list"></i> Danh sách khách sạn
                    </a>
                </div>
            </div>
        </form>
    </div>

    <!-- Hình ảnh hiện có -->
    <div class="owner-card mt-4">
        <h5 class="mb-3">
            <i class="fas fa-images me-2 text-success"></i>
            Hình ảnh hiện có ({{ hotel.images|length if hotel.images else 0 }})
        </h5>

        {% if hotel.images and hotel.images|length > 0 %}
        <div class="row g-3">
            {% for image in hotel.images %}
            <div class="col-md-3">
                <div class="position-relative">
                    <img src="{{ image.image_url }}" class="img-fluid rounded" alt="Hotel Image" style="height: 150px; width: 100%; object-fit: cover;">
                    {% if image.is_primary %}
                    <span class="badge bg-success position-absolute top-0 start-0 m-2">
                        <i class="fas fa-star"></i> Chính
                    </span>
                    {% else %}
                    <form action="{{ url_for('hotel.set_primary_image', hotel_id=hotel_id, image_id=image.image_id) }}" method="POST" class="position-absolute top-0 start-0 m-2">
                        <button type="submit" class="btn btn-sm btn-light" title="Đặt làm ảnh chính">
                            <i class="far fa-star"></i>
                        </button>
                    </form>
                    {% endif %}
                    <form action="{{ url_for('hotel.delete_image', hotel_id=hotel_id, image_id=image.image_id) }}" method="POST"
                          class="position-absolute top-0 end-0 m-2"
                          onsubmit="return confirm('Bạn có chắc muốn xóa ảnh này?');">
                        <button type="submit" class="btn btn-sm btn-danger">
                            <i class="fas fa-trash"></i>
                        </button>
                    </form>
                    <div class="position-absolute bottom-0 start-0 end-0 p-2 bg-dark bg-opacity-75 text-white small">
                        {{ image.caption or 'Không có mô tả' }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center text-muted py-4">
            <i class="fas fa-image fa-3x mb-3"></i>
            <p>Chưa có hình ảnh nào. Hãy upload ảnh đầu tiên!</p>
        </div>
        {% endif %}
    </div>

{% else %}
    <div class="alert alert-danger">
        <i class="fas fa-exclamation-circle me-2"></i>
        {{ error or 'Không thể tải thông tin khách sạn' }}
    </div>
    <a href="{{ url_for('owner.my_hotels') }}" class="owner-btn owner-btn-primary">
        <i class="fas fa-arrow-left"></i> Quay lại danh sách
    </a>
{% endif %}

{% endblock %}
