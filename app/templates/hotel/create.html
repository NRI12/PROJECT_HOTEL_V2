{% extends "owner/base.html" %}

{% block title %}Thêm khách sạn mới{% endblock %}

{% block content %}

<div class="owner-header">
    <div>
        <h1 class="owner-header-title">
            <i class="fas fa-hotel me-2"></i> Thêm khách sạn mới
        </h1>
        <p class="owner-header-subtitle">Tạo khách sạn mới với đầy đủ thông tin</p>
    </div>
    <div class="owner-header-actions">
        <a href="{{ url_for('owner.my_hotels') }}" class="owner-btn owner-btn-secondary">
            <i class="fas fa-arrow-left"></i> Quay lại
        </a>
    </div>
</div>

{% if error %}
<div class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="fas fa-exclamation-circle me-2"></i>{{ error }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
{% endif %}

<div class="owner-card">
    <form method="POST" enctype="multipart/form-data">
        
        <!-- BƯỚC 1: THÔNG TIN CƠ BẢN -->
        <h5 class="mb-3 pb-2 border-bottom">
            <i class="fas fa-info-circle me-2 text-primary"></i>1. Thông tin cơ bản
        </h5>
        <div class="row g-3 mb-4">
            <div class="col-md-8">
                <label class="form-label">Tên khách sạn *</label>
                <input type="text" name="hotel_name" class="form-control" 
                       placeholder="VD: Khách sạn Paradise Resort & Spa" 
                       value="{{ request.form.hotel_name or request.args.hotel_name or '' }}" 
                       required>
            </div>

            <div class="col-md-4">
                <label class="form-label">Số sao (1-5)</label>
                <select name="star_rating" class="form-control">
                    <option value="">-- Chọn số sao --</option>
                    {% for i in range(1, 6) %}
                    <option value="{{ i }}" {% if (request.form.star_rating or request.args.star_rating) == i|string %}selected{% endif %}>
                        {{ i }} <i class="fas fa-star text-warning"></i>
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-12">
                <label class="form-label">Mô tả khách sạn</label>
                <textarea name="description" class="form-control" rows="4" 
                          placeholder="Mô tả chi tiết về khách sạn, dịch vụ, tiện ích...">{{ request.form.description or request.args.description or '' }}</textarea>
            </div>
        </div>

        <!-- BƯỚC 2: ĐỊA CHỈ & VỊ TRÍ -->
        <h5 class="mb-3 pb-2 border-bottom">
            <i class="fas fa-map-marker-alt me-2 text-danger"></i>2. Địa chỉ & Vị trí
        </h5>
        <div class="row g-3 mb-4">
            <div class="col-md-12">
                <label class="form-label">Địa chỉ đầy đủ *</label>
                <input type="text" name="address" class="form-control" 
                       placeholder="VD: 123 Đường Trần Hưng Đạo" 
                       value="{{ request.form.address or request.args.address or '' }}" 
                       required>
            </div>

            <div class="col-md-4">
                <label class="form-label">Phường/Xã</label>
                <input type="text" name="ward" class="form-control" 
                       placeholder="VD: Phường Bến Nghé" 
                       value="{{ request.form.ward or request.args.ward or '' }}">
            </div>

            <div class="col-md-4">
                <label class="form-label">Quận/Huyện</label>
                <input type="text" name="district" class="form-control" 
                       placeholder="VD: Quận 1" 
                       value="{{ request.form.district or request.args.district or '' }}">
            </div>

            <div class="col-md-4">
                <label class="form-label">Thành phố *</label>
                <input type="text" name="city" class="form-control" 
                       placeholder="VD: Hồ Chí Minh" 
                       value="{{ request.form.city or request.args.city or '' }}" 
                       required>
            </div>

            <div class="col-md-6">
                <label class="form-label">Vĩ độ (Latitude)</label>
                <input type="number" name="latitude" class="form-control" 
                       step="0.00000001" 
                       placeholder="VD: 10.7756" 
                       value="{{ request.form.latitude or request.args.latitude or '' }}">
                <small class="text-muted">Tọa độ GPS để hiển thị trên bản đồ</small>
            </div>

            <div class="col-md-6">
                <label class="form-label">Kinh độ (Longitude)</label>
                <input type="number" name="longitude" class="form-control" 
                       step="0.00000001" 
                       placeholder="VD: 106.7019" 
                       value="{{ request.form.longitude or request.args.longitude or '' }}">
                <small class="text-muted">Tọa độ GPS để hiển thị trên bản đồ</small>
            </div>
        </div>

        <!-- BƯỚC 3: THÔNG TIN LIÊN HỆ -->
        <h5 class="mb-3 pb-2 border-bottom">
            <i class="fas fa-phone me-2 text-success"></i>3. Thông tin liên hệ
        </h5>
        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <label class="form-label">Số điện thoại</label>
                <input type="text" name="phone" class="form-control" 
                       placeholder="VD: 028 1234 5678" 
                       value="{{ request.form.phone or request.args.phone or '' }}">
            </div>

            <div class="col-md-6">
                <label class="form-label">Email</label>
                <input type="email" name="email" class="form-control" 
                       placeholder="VD: contact@hotel.com" 
                       value="{{ request.form.email or request.args.email or '' }}">
            </div>
        </div>

        <!-- BƯỚC 4: CHÍNH SÁCH CHECK-IN/OUT -->
        <h5 class="mb-3 pb-2 border-bottom">
            <i class="fas fa-clock me-2 text-warning"></i>4. Chính sách Check-in/Check-out
        </h5>
        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <label class="form-label">Giờ nhận phòng</label>
                <input type="time" name="check_in_time" class="form-control" 
                       value="{{ request.form.check_in_time or request.args.check_in_time or '14:00' }}">
                <small class="text-muted">Giờ khách có thể nhận phòng (mặc định: 14:00)</small>
            </div>

            <div class="col-md-6">
                <label class="form-label">Giờ trả phòng</label>
                <input type="time" name="check_out_time" class="form-control" 
                       value="{{ request.form.check_out_time or request.args.check_out_time or '12:00' }}">
                <small class="text-muted">Giờ khách phải trả phòng (mặc định: 12:00)</small>
            </div>
        </div>

        <!-- BƯỚC 5: HÌNH ẢNH -->
        <h5 class="mb-3 pb-2 border-bottom">
            <i class="fas fa-images me-2 text-info"></i>5. Hình ảnh khách sạn
        </h5>
        <div class="mb-4">
            <label class="form-label">Upload hình ảnh</label>
            <input type="file" name="images" class="form-control" multiple accept="image/*" id="imageInput">
            <small class="text-muted">Chọn nhiều ảnh (JPG, PNG, GIF, WEBP). Ảnh đầu tiên sẽ là ảnh chính.</small>
            
            <div id="imagePreview" class="mt-3" style="display: none;">
                <div class="row g-2" id="previewContainer"></div>
            </div>
        </div>

        <!-- NÚT HÀNH ĐỘNG -->
        <div class="col-12">
            <button type="submit" class="owner-btn owner-btn-primary">
                <i class="fas fa-save me-2"></i> Tạo khách sạn
            </button>
            <a href="{{ url_for('owner.my_hotels') }}" class="owner-btn owner-btn-outline-secondary">
                <i class="fas fa-times me-2"></i> Hủy
            </a>
        </div>
    </form>
</div>

<script>
// Image preview functionality
document.getElementById('imageInput').addEventListener('change', function(e) {
    const previewDiv = document.getElementById('imagePreview');
    const container = document.getElementById('previewContainer');
    const files = e.target.files;
    
    if (files.length > 0) {
        container.innerHTML = '';
        previewDiv.style.display = 'block';
        
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const col = document.createElement('div');
                col.className = 'col-md-3';
                col.innerHTML = `
                    <div class="position-relative">
                        <img src="${e.target.result}" class="img-thumbnail" style="width: 100%; height: 150px; object-fit: cover;">
                        ${i === 0 ? '<span class="badge bg-primary position-absolute top-0 start-0 m-2">Ảnh chính</span>' : ''}
                    </div>
                `;
                container.appendChild(col);
            };
            
            reader.readAsDataURL(file);
        }
    } else {
        previewDiv.style.display = 'none';
    }
});
</script>

{% endblock %}